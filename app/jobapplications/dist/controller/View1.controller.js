sap.ui.define(["sap/ui/core/mvc/Controller","sap/m/MessageBox","sap/m/MessageToast"],function(t,e,o){"use strict";return t.extend("jobapplications.controller.View1",{_oDraftCtx:null,onInit:function(){const t=new sap.ui.model.json.JSONModel({Company:{CompanyID:"",CompanyName:""},Job:{JobID:"",Role:"",Location:""},Application:{Status:"APPLIED",AppliedDate:null},Attachments:[],ui:{companyNextVisible:false,jobNextVisible:false,applicationNextVisible:false}});this.getView().setModel(t,"local");t.setProperty("/Company/CompanyID",this._generateCompanyID());t.setProperty("/Job/JobID",this._generateJobID());this._validateCompanyStep()},onNextFromCompany:function(){const t=this.byId("jobWizard");t.validateStep(this.byId("stepCompany"));t.nextStep()},onNextFromJob:function(){const t=this.byId("jobWizard");t.validateStep(this.byId("stepJob"));t.nextStep()},onNextFromApplication:function(){const t=this.byId("jobWizard");t.validateStep(this.byId("stepApplication"));t.nextStep();this.byId("submitBtn").setVisible(true);this.byId("saveDraftBtn").setVisible(true)},onCompanyChange:function(t){const e=t.getSource().getValue().trim();const o=this.getView().getModel("local");t.getSource().setValueState(e?"None":"Error");o.setProperty("/ui/companyNextVisible",!!e)},onJobChange:function(){const t=this.getView();const e=t.byId("_IDGenInput3").getValue().trim();const o=t.byId("_IDGenInput4").getValue().trim();t.getModel("local").setProperty("/ui/jobNextVisible",!!(e&&o))},onApplicationChange:function(){const t=this.getView().getModel("local");const e=!!t.getProperty("/Application/AppliedDate")&&t.getProperty("/Attachments").length>0;t.setProperty("/ui/applicationNextVisible",e)},_validateCompanyStep:function(){const t=!!this.getView().getModel("local").getProperty("/Company/CompanyName");this.getView().getModel("local").setProperty("/ui/companyNextVisible",t)},onFileChange:function(t){const e=t.getParameter("files");if(!e||!e.length){return}const o=Array.from(e);const i=this.getView().getModel("local");const a=o.map(t=>({displayName:"Resume",fileName:t.name,mediaType:t.type,fileObject:t}));i.setProperty("/Attachments",a);this.onApplicationChange()},onPreviewAttachment:function(t){const e=t.getSource().getBindingContext("local").getObject();const o=URL.createObjectURL(e.fileObject);window.open(o,"_blank");setTimeout(()=>URL.revokeObjectURL(o),1e3)},onSaveDraft:async function(){const t=this.getView();const o=this.getOwnerComponent().getModel();const i=t.getModel("local").getData();try{await o.bindList("/Companies").create({CompanyID:i.Company.CompanyID,CompanyName:i.Company.CompanyName}).created();await o.bindList("/Jobs").create({JobID:i.Job.JobID,CompanyID:i.Company.CompanyID,Role:i.Job.Role,Location:i.Job.Location}).created();if(!this._oDraftCtx){const t=o.bindList("/Applications");this._oDraftCtx=t.create({JobID:i.Job.JobID,Status:i.Application.Status,AppliedDate:i.Application.AppliedDate});await this._oDraftCtx.created()}const a=i.Attachments||[];const n=o.bindList(this._oDraftCtx.getPath()+"/Attachments");for(const t of a){await n.create({FileName:t.fileName,MediaType:t.mediaType}).created()}t.setBindingContext(this._oDraftCtx);e.success("Draft saved")}catch(t){console.error(t);e.error("Draft save failed")}},onSubmit:async function(){const t=this.getView();let o=t.getBindingContext();try{if(o&&o.getProperty("IsActiveEntity")===false){await o.getModel().bindContext(o.getPath()+"/JobService.draftActivate(...)").execute();e.success("Application submitted successfully");this._afterSubmitReset();return}await this.onSaveDraft();o=t.getBindingContext();await o.getModel().bindContext(o.getPath()+"/JobService.draftActivate(...)").execute();e.success("Application submitted successfully");this._afterSubmitReset()}catch(t){console.error(t);e.error("Submit failed")}},_afterSubmitReset:function(){this._oDraftCtx=null;this.getView().setBindingContext(null);this._resetWizard()},_resetWizard:function(){const t=this.byId("jobWizard");const e=this.getView().getModel("local");e.setData({Company:{CompanyID:this._generateCompanyID(),CompanyName:""},Job:{JobID:this._generateJobID(),Role:"",Location:""},Application:{Status:"APPLIED",AppliedDate:null},Attachments:[],ui:{companyNextVisible:false,jobNextVisible:false,applicationNextVisible:false}});t.discardProgress(t.getSteps()[0]);t.goToStep(t.getSteps()[0]);this.byId("submitBtn").setVisible(false);this.byId("saveDraftBtn").setVisible(false)},_generateCompanyID:()=>"C"+Math.floor(100+Math.random()*900),_generateJobID:()=>"J"+Math.floor(100+Math.random()*900)})});
//# sourceMappingURL=View1.controller.js.map